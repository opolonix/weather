<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cascadia+Mono:ital,wght@0,200..700;1,200..700&display=swap" rel="stylesheet">

</head>
<body>
    <style>
        body, html {
            color: #ffffff;
            background-color: #000;
            
        }

        .wrapper {
            pre {
                :first-child {
                    border-top-left-radius: 20px !important;
                    border-top-right-radius: 20px !important;
                    border-bottom-left-radius: 5px;
                    border-bottom-right-radius: 5px;
                }
                :last-child {
                    border-top-left-radius: 5px;
                    border-top-right-radius: 5px;
                    border-bottom-left-radius: 20px !important;
                    border-bottom-right-radius: 20px !important;
                }

            }
        }

        pre {
            background-color: #141414;
            /* box-shadow: inset 0 0 10px #0a0a0a; */
            font-family: "Cascadia Mono", sans-serif;
            font-size: 2.5vh;
            user-select: none;
            width: fit-content;
            padding: 15px 20px;
            border-radius: 2px;
            /* font-family: 'Times New Roman', Times, serif; */
        }
        pre span {
            cursor: pointer;
            transition-duration: .1s;
        }
        pre span:hover {
            background-color: #242424;
        }
        pre span:not([key]) {
            color: #8b8b8b;
        }
        pre span[unit] {
            display: none;
            padding-left: 4px;
            background-color: #242424;
            width: fit-content;
        }
    </style>
    <div class="wrapper">
    <pre>
<span alt="скобка">{</span>
    <span alt="&quot;локация&quot;">"loc"</span><span>: </span><span alt="Симферополь" key>Simferopol</span>,
    <span alt="&quot;температура&quot;">"temp"</span><span>: </span><span key="temperature">{{w.temperature}}</span><span unit>°C</span>,
    <span alt="&quot;давление&quot;">"pres"</span><span>: </span><span key="pressure">{{w.pressure}}</span><span unit>Pa</span>,
    <span alt="&quot;высота&quot;">"alti"</span><span>: </span><span key="altitude">{{w.altitude}}</span><span unit>m</span>,
    <span alt="&quot;влажность&quot;">"humi"</span><span>: </span><span key="humidity">{{w.humidity}}</span><span unit>%</span>
<span alt="скобка">}</span>
</pre>
    </div>

<script>
    function fallbackCopyTextToClipboard(text) {
  var textArea = document.createElement("textarea");
  textArea.value = text;
  
  // Avoid scrolling to bottom
  textArea.style.top = "0";
  textArea.style.left = "0";
  textArea.style.position = "fixed";

  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();

  try {
    var successful = document.execCommand('copy');
    var msg = successful ? 'successful' : 'unsuccessful';
    console.log('Fallback: Copying text command was ' + msg);
  } catch (err) {
    console.error('Fallback: Oops, unable to copy', err);
  }

  document.body.removeChild(textArea);
}
function copyTextToClipboard(text) {
  if (!navigator.clipboard) {
    fallbackCopyTextToClipboard(text);
    return;
  }
  navigator.clipboard.writeText(text).then(function() {
    console.log('Async: Copying to clipboard was successful!');
  }, function(err) {
    console.error('Async: Could not copy text: ', err);
  });
}
    document.querySelectorAll("pre > span").forEach(el => {
        el.addEventListener("click", e => {
            copyTextToClipboard(el.innerText)
        })
    })


    document.querySelectorAll("pre > span[key]").forEach(el => {
        if (el.getAttribute("key")) {
            el.addEventListener("mouseenter", e => {
                el.nextElementSibling.style.display = "inline"
            })
            el.addEventListener("mouseleave", e => {
                el.nextElementSibling.style.display = "none"
            })
        }
    })

    document.querySelectorAll("pre > span[alt]").forEach(el => {
        let last_value = null;
        el.addEventListener("mouseenter", e => {
            last_value = el.innerText
            el.innerText = el.getAttribute("alt")
        })
        el.addEventListener("mouseleave", e => {
            el.innerText = last_value
        })
    })
    
    setInterval(async () => {
        data = await fetch("/get/weather")
        data = await data.json()
        document.querySelectorAll("pre > span[key]").forEach(el => {
            if (el.getAttribute("key") && data[el.getAttribute("key")] != el.innerText) {
                el.innerText = data[el.getAttribute("key")]
            }
        })
    }, 3000)
</script>
</body>
</html>